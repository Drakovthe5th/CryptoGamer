<!DOCTYPE html>
<html>
<head>
    <title>CryptoGameBot MiniApp</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="{{ url_for('static', filename='js/charts.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/miniapp.css') }}">
    <!-- Monetag SDK -->
    <script src='//libtl.com/sdk.js' data-zone='9644715' data-sdk='show_9644715'></script>
</head>
<body>
    <div id="app" class="container">
        <div class="header">
            <h1>CryptoGame Miner</h1>
        </div>
        
        <div class="balance-card">
            <div class="balance-label">Your Balance</div>
            <div class="balance-amount" id="balance">0.000000 XNO</div>
            <div class="min-withdrawal">
                Minimum withdrawal: <span id="min-withdrawal">XNO</span>
            </div>
        </div>
        
        <div class="section" id="quests-section">
            <div class="section-title">Active Quests</div>
            <div id="quests-container" class="loading">
                Loading quests...
            </div>
        </div>
        
        <div class="ad-section">
            <div class="boost-banner">Weekend Boost! +50% Earnings</div>
            <div id="ad-container">
                <div class="ad-placeholder">
                    <div class="spinner"></div>
                    <p>Loading ad...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ads.js') }}"></script>
    <script>
        // Initialize Telegram WebApp
        const webApp = Telegram.WebApp;
        webApp.ready();
        webApp.expand();
        
        // Get user ID from Telegram
        const userId = webApp.initDataUnsafe.user?.id;
        const country = webApp.initDataUnsafe.user?.language_code || 'US';
        
        if (!userId) {
            document.getElementById('app').innerHTML = 
                '<div class="error">Error: User authentication failed</div>';
            throw new Error("User ID not available");
        }

        // Initialize Ad Manager
        window.adManager = new AdManager({
            userId: userId,
            country: country,
            coinzillaZoneId: 'YOUR_COINZILLA_ZONE',
            propellerZoneId: 'YOUR_PROPELLER_ZONE',
            aAdsZoneId: '2405512' // A-ads zone ID
        });
        
        // Load initial data
        loadUserData();
        
        // Refresh data every 60 seconds
        setInterval(loadUserData, 60000);
    </script>
</body>
</html>