<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>🎮 CryptoGameMiner</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/miniapp.css') }}">

</head>
<body>
  <div class="container">
    <!-- Loading Spinner -->
    <div class="spinner-overlay" id="global-spinner">
      <div class="spinner"></div>
    </div>

    <!-- Security Alert -->
    <div class="security-alert" id="security-alert">
      ⚠️ Suspicious activity detected! Account temporarily restricted.
    </div>

    <!-- HEADER -->
    <header class="app-header slide-in">
      <button class="profile-btn" onclick="showPage('profile')">
        <span class="nav-icon">👤</span>
        <span id="profile-username">Guest</span>
      </button>
      <div class="balance-display">
        <span id="balance">0.000000</span> TON
      </div>
    </header>

    <!-- Wallet Status -->
    <div class="wallet-status" id="wallet-status">
      <div class="status-indicator" id="status-indicator"></div>
      <span id="wallet-status-text">Connecting to TON network...</span>
    </div>

    <!-- HOME -->
    <div id="home-page" class="page active">
      <div class="section slide-in">
        <h2 class="section-title">🎁 Daily Bonus</h2>
        <p style="margin-bottom: 16px; color: #ccc;">
          Grab your daily reward and keep the momentum going!
        </p>
        <div class="ad-slot" id="home_top_banner" style="height:90px; margin:10px 0;"></div>
        <button class="btn" id="bonus-btn" onclick="claimDailyBonus()">
          🎁 Claim Daily Bonus
        </button>
      </div>

      <div class="section slide-in">
        <h2 class="section-title">⚡ Click & Earn</h2>
        <div class="click-area" onclick="earnFromClick()">
          <div class="click-text">TAP TO EARN</div>
        </div>
        <p style="text-align: center; margin-top: 12px; color: #ccc;">
          Clicks today: <span id="click-count" style="color: var(--primary-yellow); font-weight: bold;">0</span>/100
        </p>
      </div>

      <div class="section slide-in">
        <h2 class="section-title">🎮 Featured Games</h2>
        <div class="game-grid">
          <div class="game-card" onclick="launchGame('trivia')">
            <div class="game-icon">❓</div>
            <div class="game-name">Crypto Trivia</div>
          </div>
          <div class="game-card" onclick="launchGame('spin')">
            <div class="game-icon">🎡</div>
            <div class="game-name">Lucky Spin</div>
          </div>
          <div class="game-card" onclick="launchGame('clicker')">
            <div class="game-icon">🖱️</div>
            <div class="game-name">TON Clicker</div>
          </div>
          <div class="game-card" onclick="launchGame('trex')">
            <div class="game-icon">🦖</div>
            <div class="game-name">T-Rex Runner</div>
          </div>
        </div>
      </div>
    </div>

    <!-- WATCH ADS -->
    <div id="watch-page" class="page">
      <div class="section">
        <h2 class="section-title">📺 Watch & Earn</h2>
        <p style="margin-bottom: 16px; color: #ccc;">
          Watch video ads and boost your TON balance instantly!
        </p>
        <button class="btn" onclick="rewardedInterstitial()">
          ▶️ Watch Ad & Earn TON
        </button>
        <div style="margin-top: 16px; padding: 12px; background: rgba(255,204,0,0.1); border-radius: 8px;">
          <small style="color: #ffcc00;">💡 Tip: Weekend ads give 20% bonus!</small>
        </div>
      </div>

      <!-- Ad Banner Space -->
      <div class="section" style="padding: 0; overflow: hidden; min-height: 200px;">
        <div style="width: 100%; height: 200px; background: rgba(255,255,255,0.05); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
          <div style="text-align: center; color: #666;">
            <div style="font-size: 2rem; margin-bottom: 8px;">📺</div>
            <div>Ad Banner Placeholder</div>
            <div class="section slide-in">
            <div class="ad-slot" id="home_bottom_banner" style="height:250px;"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- WALLET -->
    <div id="wallet-page" class="page">
      <div class="section">
        <h2 class="section-title">💰 Your Wallet</h2>
        <div style="text-align: center; margin: 20px 0;">
          <div style="font-size: 3rem; font-weight: 700; color: var(--accent-green);">
            <span id="wallet-balance">0.000000</span> TON
          </div>
          <div style="color: #888; margin-top: 8px;">Total Balance</div>
          <div style="font-size: 0.8rem; color: #666; margin-top: 4px;" id="wallet-address">
            Wallet: Loading...
          </div>
          <div class="section">
          <div class="ad-slot" id="wallet_mid_banner" style="height:100px;"></div>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px;">
          <button class="btn btn-secondary" onclick="showWithdrawalForm()">
            📤<br/>Withdraw
          </button>
          <button class="btn btn-secondary" onclick="showTransactionHistory()">
            📋<br/>History
          </button>
          <button class="btn btn-secondary" onclick="showPage('otc')">
            💱<br/>Trade
          </button>
        </div>

        <!-- Withdrawal Form -->
        <div class="withdrawal-form" id="withdrawal-form">
          <h3 style="margin-bottom: 16px; color: var(--primary-yellow);">Withdraw TON</h3>
          
          <div class="input-group">
            <label for="withdraw-address">TON Wallet Address</label>
            <input type="text" id="withdraw-address" placeholder="EQxxxxx..." />
          </div>
          
          <div class="input-group">
            <label for="withdraw-amount">Amount (TON)</label>
            <input type="number" id="withdraw-amount" placeholder="0.000000" step="0.000001" min="0.1" />
            <small style="color: #888;">Minimum withdrawal: 0.1 TON</small>
          </div>
          
          <div style="display: flex; gap: 8px;">
            <button class="btn btn-secondary" onclick="hideWithdrawalForm()">Cancel</button>
            <button class="btn" onclick="processWithdrawal()">Withdraw</button>
          </div>
        </div>
      </div>

      <div class="section">
        <h2 class="section-title">📈 Staking</h2>
        <div style="margin-bottom: 16px;">
          <p>Earn <span style="color: var(--accent-green); font-weight: bold;">8.5% APY</span> on deposits of 5+ TON</p>
          <small style="color: #888;">Rewards are distributed daily</small>
        </div>
        <button class="btn" onclick="startStaking()">
          💰 Start Staking (5 TON min)
        </button>
      </div>

      <div class="section">
        <h2 class="section-title">📊 Stats</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="total-earned">0.000000</div>
            <div class="stat-label">Total Earned</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="games-played">0</div>
            <div class="stat-label">Games Played</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="ads-watched">0</div>
            <div class="stat-label">Ads Watched</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="referrals-count">0</div>
            <div class="stat-label">Referrals</div>
          </div>
        </div>
      </div>

      <!-- Transaction History -->
      <div class="section" id="transaction-history" style="display: none;">
        <h2 class="section-title">📋 Recent Transactions</h2>
        <div id="transaction-list">
          <!-- Transactions will be loaded here -->
        </div>
      </div>
    </div>

    <!-- GAMES -->
    <div id="games-page" class="page">
      <div class="section">
        <h2 class="section-title">🎮 All Games</h2>
        <p style="margin-bottom: 20px; color: #ccc;">
          Play games, earn TON coins, and climb the leaderboards!
        </p>
        
        <div class="game-grid">
          <div class="game-card" onclick="launchGame('trivia')">
            <div class="game-icon">❓</div>
            <div class="game-name">Crypto Trivia</div>
            <small style="color: #888;">Test your knowledge</small>
          </div>
          
          <div class="game-card" onclick="launchGame('spin')">
            <div class="game-icon">🎡</div>
            <div class="game-name">Lucky Spin</div>
            <small style="color: #888;">Spin to win big</small>
          </div>
          
          <div class="game-card" onclick="launchGame('clicker')">
            <div class="game-icon">🖱️</div>
            <div class="game-name">TON Clicker</div>
            <small style="color: #888;">Click for rewards</small>
          </div>
          
          <div class="game-card" onclick="launchGame('trex')">
            <div class="game-icon">🦖</div>
            <div class="game-name">T-Rex Runner</div>
            <small style="color: #888;">Endless runner</small>
          </div>
          
          <div class="game-card" onclick="launchGame('edge-surf')">
            <div class="game-icon">🏄</div>
            <div class="game-name">Edge Surf</div>
            <small style="color: #888;">Surf the web</small>
          </div>
          
          <div class="game-card" style="opacity: 0.6;">
            <div class="game-icon">🎲</div>
            <div class="game-name">More Games</div>
            <small style="color: #888;">Coming soon</small>
          </div>
          <div class="section">
          <div class="ad-slot" id="game_bottom_banner" style="height:120px;"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- QUESTS -->
    <div id="quests-page" class="page">
      <div class="section">
        <h2 class="section-title">📝 Daily Quests</h2>
        <p style="margin-bottom: 16px; color: #ccc;">
          Complete daily tasks to earn bonus rewards!
        </p>
        
        <div class="quest-item">
          <div>
            <div style="font-weight: 600;">✅ Claim Daily Bonus</div>
            <small style="color: #888;">Reward: <span id="quest-bonus-reward">0.01</span> TON</small>
          </div>
          <button class="btn btn-small" id="quest-bonus" onclick="claimDailyBonus()">Claim</button>
        </div>

        <div class="section">
        <div class="ad-slot" id="quest_bottom_banner" style="height:80px;"></div>
        </div>
        
        <div class="quest-item">
          <div>
            <div style="font-weight: 600;">📺 Watch 3 Ads</div>
            <small style="color: #888;">Progress: <span id="quest-ads">0</span>/3 | Reward: <span id="quest-ads-reward">0.009</span> TON</small>
          </div>
          <button class="btn btn-small btn-secondary" onclick="showPage('watch')">Watch</button>
        </div>
        
        <div class="quest-item">
          <div>
            <div style="font-weight: 600;">🎮 Play 2 Games</div>
            <small style="color: #888;">Progress: <span id="quest-games">0</span>/2 | Reward: <span id="quest-games-reward">0.006</span> TON</small>
          </div>
          <button class="btn btn-small btn-secondary" onclick="showPage('games')">Play</button>
        </div>
        
        <div class="quest-item">
          <div>
            <div style="font-weight: 600;">👥 Invite 1 Friend</div>
            <small style="color: #888;">Progress: <span id="quest-invite">0</span>/1 | Reward: <span id="quest-invite-reward">0.05</span> TON</small>
          </div>
          <button class="btn btn-small btn-secondary" onclick="showPage('referrals')">Invite</button>
        </div>
      </div>

      <div class="section">
        <h2 class="section-title">🏆 Weekly Challenges</h2>
        
        <div class="quest-item">
          <div>
            <div style="font-weight: 600;">🔥 7-Day Streak</div>
            <small style="color: #888;">Login daily for a week | Reward: 0.5 TON</small>
          </div>
          <div style="color: var(--primary-yellow); font-weight: bold;" id="daily-streak">0/7</div>
        </div>
        
        <div class="quest-item">
          <div>
            <div style="font-weight: 600;">💯 Score 1000+ Points</div>
            <small style="color: #888;">In any game | Reward: 0.1 TON</small>
          </div>
          <div style="color: #888;" id="high-score">0/1000</div>
        </div>
        
        <div class="quest-item">
          <div>
            <div style="font-weight: 600;">📱 Share App</div>
            <small style="color: #888;">Share with 5 friends | Reward: 0.25 TON</small>
          </div>
          <button class="btn btn-small btn-secondary" onclick="shareMission()">Share</button>
        </div>
      </div>
    </div>

    <!-- OTC TRADING -->
    <div id="otc-page" class="page">
      <div class="section">
        <h2 class="section-title">💱 OTC Exchange</h2>
        <p style="margin-bottom: 20px; color: #ccc;">
          Trade your TON for fiat currencies instantly!
        </p>
        
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 8px; font-weight: 600;">Amount (TON)</label>
          <input type="number" id="otc-amount" placeholder="0.000000" step="0.000001" min="0.1" />
        </div>
        
        <div style="margin-bottom: 16px;">
          <label style="display: block; margin-bottom: 8px; font-weight: 600;">Currency</label>
          <select id="otc-currency">
            <option value="USDT">USDT (Tether)</option>
            <option value="USD">USD (US Dollar)</option>
            <option value="KES">KES (Kenyan Shilling)</option>
            <option value="EUR">EUR (Euro)</option>
          </select>
        </div>
        
        <div id="conversion-preview" style="background: rgba(255,204,0,0.1); padding: 12px; border-radius: 8px; margin-bottom: 16px; display: none;">
          <div style="color: var(--primary-yellow); font-weight: 600;">Conversion Preview:</div>
          <div id="conversion-text"></div>
          <small style="color: #888;" id="fee-text">Fee: 3% (min $1.00)</small>
        </div>
        
        <button class="btn" onclick="swapTon()">
          💱 Start Exchange
        </button>
      </div>

      <div class="section">
        <h2 class="section-title">💹 Current Rates</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="rate-usd">$6.80</div>
            <div class="stat-label">1 TON = USD</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="rate-kes">950</div>
            <div class="stat-label">1 TON = KES</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="rate-eur">€6.20</div>
            <div class="stat-label">1 TON = EUR</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="rate-usdt">6.75</div>
            <div class="stat-label">1 TON = USDT</div>
          </div>
        </div>
        <small style="color: #888; display: block; text-align: center; margin-top: 12px;">
          ⏰ Rates updated every 5 minutes
        </small>
      </div>
    </div>

    <!-- REFERRALS -->
    <div id="referrals-page" class="page">
      <div class="referral-box">
        <h2>👥 Invite & Earn</h2>
        <p style="margin: 12px 0;">Earn 20% of your friends' earnings forever!</p>
        <div class="referral-link" id="ref-link">
          https://t.me/CryptoGameMinerBot?start=ref-xyz123
        </div>
        <button class="btn" onclick="copyReferralLink()" style="background: rgba(255,255,255,0.2); color: white;">
          📋 Copy Invite Link
        </button>
      </div>

      <div class="section">
        <h2 class="section-title">📊 Your Referral Stats</h2>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="ref-count">0</div>
            <div class="stat-label">Friends Invited</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="ref-earnings">0.000000</div>
            <div class="stat-label">Total Earned (TON)</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="ref-active">0</div>
            <div class="stat-label">Active This Week</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="ref-level">1</div>
            <div class="stat-label">Referrer Level</div>
          </div>
        </div>
      </div>

      <div class="section">
        <h2 class="section-title">🎯 Referral Milestones</h2>
        <div style="margin: 16px 0;">
          <div class="quest-item">
            <span>🥉 3 referrals → Bonus 0.01 TON</span>
            <span style="color: var(--accent-green);" id="milestone-3">0/3</span>
          </div>
          <div class="quest-item">
            <span>🥈 10 referrals → Bonus 0.05 TON</span>
            <span style="color: #888;" id="milestone-10">0/10</span>
          </div>
          <div class="quest-item">
            <span>🥇 50 referrals → Bonus 0.25 TON</span>
            <span style="color: #888;" id="milestone-50">0/50</span>
          </div>
          <div class="quest-item">
            <span>💎 100 referrals → Bonus 1.0 TON</span>
            <span style="color: #888;" id="milestone-100">0/100</span>
          </div>
        </div>
      </div>
    </div>

    <!-- PROFILE -->
    <div id="profile-page" class="page">
      <div class="section">
        <h2 class="section-title">👤 Profile</h2>
        <div style="text-align: center; margin: 20px 0;">
          <div style="width: 80px; height: 80px; background: var(--gradient-purple); border-radius: 50%; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center; font-size: 2rem;">
            👤
          </div>
          <h3 id="profile-name">Guest</h3>
          <p style="color: #888;" id="member-since">Member since today</p>
        </div>
        
        <div style="background: rgba(255,255,255,0.05); padding: 16px; border-radius: 8px; margin: 16px 0;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span>Current Balance:</span>
            <span style="color: var(--accent-green); font-weight: bold;"><span id="profile-balance">0.000000</span> TON</span>
          </div>
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span>Total Earned:</span>
            <span style="color: var(--primary-yellow); font-weight: bold;"><span id="profile-total-earned">0.000000</span> TON</span>
          </div>
          <div style="display: flex; justify-content: space-between;">
            <span>Account Level:</span>
            <span style="color: #888;" id="account-level">Beginner</span>
          </div>
        </div>
      </div>

      <div class="section">
        <h2 class="section-title">🏆 Achievements</h2>
        <div class="achievement-grid" id="achievements-list">
          <div class="achievement-badge">🎯 First Click</div>
          <div class="achievement-badge">📺 Ad Watcher</div>
          <div class="achievement-badge" style="opacity: 0.5;">🎮 Game Master</div>
          <div class="achievement-badge" style="opacity: 0.5;">💰 Big Earner</div>
          <div class="achievement-badge" style="opacity: 0.5;">👥 Influencer</div>
          <div class="achievement-badge" style="opacity: 0.5;">⭐ VIP Member</div>
        </div>
      </div>

      <div class="section">
        <h2 class="section-title">⚙️ Settings & Info</h2>
        <button class="btn btn-secondary" onclick="showHelp()">
          ❓ Help & Support
        </button>
        <button class="btn btn-secondary" onclick="showAbout()">
          📜 About CryptoGameMiner
        </button>
        <button class="btn btn-secondary" onclick="showTerms()">
          📄 Terms of Service
        </button>
        <button class="btn btn-secondary" onclick="showPrivacy()">
          🔒 Privacy Policy
        </button>
      </div>
    </div>

  </div>

  <!-- NAVIGATION -->
  <nav class="nav-bar">
    <button class="nav-btn active" onclick="showPage('home')">
      <span class="nav-icon">🏠</span>
      <span>Home</span>
    </button>
    <button class="nav-btn" onclick="showPage('watch')">
      <span class="nav-icon">📺</span>
      <span>Watch</span>
    </button>
    <button class="nav-btn" onclick="showPage('wallet')">
      <span class="nav-icon">💰</span>
      <span>Wallet</span>
    </button>
    <button class="nav-btn" onclick="showPage('games')">
      <span class="nav-icon">🎮</span>
      <span>Games</span>
    </button>
    <button class="nav-btn" onclick="showPage('quests')">
      <span class="nav-icon">📝</span>
      <span>Quests</span>
    </button>
    <button class="nav-btn" onclick="showPage('otc')">
      <span class="nav-icon">💱</span>
      <span>Trade</span>
    </button>
    <button class="nav-btn" onclick="showPage('referrals')">
      <span class="nav-icon">👥</span>
      <span>Invite</span>
    </button>
  </nav>

  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script src="{{ url_for('static', filename='js/miniapp.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ads.js') }}"></script>
  <script src="{{ url_for('static', filename='js/staking.js') }}"></script>
  <script src="{{ url_for('static', filename='js/ad_loader.js') }}"></script>

</body>
</html>