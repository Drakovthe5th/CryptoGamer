<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Affiliate Program</title>
    <link rel="stylesheet" href="../css/main.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        .affiliate-stats {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #444;
        }
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        .referral-link {
            background: rgba(255, 204, 0, 0.1);
            border: 1px solid #ffcc00;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="app-header">
            <h1>ü§ù Affiliate Program</h1>
            <button onclick="switchPage('home')">‚Üê Back</button>
        </header>
        
        <div class="affiliate-stats">
            <h2>Your Performance</h2>
            <div class="stat-item">
                <span>Total Referrals:</span>
                <span id="total-referrals">0</span>
            </div>
            <div class="stat-item">
                <span>Active Referrals:</span>
                <span id="active-referrals">0</span>
            </div>
            <div class="stat-item">
                <span>Total Earnings:</span>
                <span id="total-earnings">0 Stars</span>
            </div>
            <div class="stat-item">
                <span>Pending Earnings:</span>
                <span id="pending-earnings">0 Stars</span>
            </div>
        </div>
        
        <div class="referral-link">
            <h3>Your Referral Link</h3>
            <p id="referral-url">Loading...</p>
            <button onclick="copyReferralLink()" class="btn-primary">üìã Copy Link</button>
        </div>
        
        <div class="affiliate-actions">
            <button onclick="shareReferralLink()" class="btn-secondary">üì§ Share via Telegram</button>
            <button onclick="viewReferralHistory()" class="btn-secondary">üìä View Referral History</button>
        </div>
        
        <div class="affiliate-info">
            <h3>How It Works</h3>
            <ul>
                <li>Share your unique referral link with friends</li>
                <li>Earn 5% commission on their purchases</li>
                <li>Get bonus Stars for reaching milestones</li>
                <li>Withdraw your earnings directly to your wallet</li>
            </ul>
        </div>
    </div>

    <script>
        let referralLink = '';
        
        function loadAffiliateStats() {
            fetch('/api/affiliate/stats', {
                headers: {
                    'X-Telegram-InitData': Telegram.WebApp.initData
                }
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('total-referrals').textContent = data.total_referrals || 0;
                document.getElementById('active-referrals').textContent = data.active_referrals || 0;
                document.getElementById('total-earnings').textContent = (data.total_earnings || 0) + ' Stars';
                document.getElementById('pending-earnings').textContent = (data.pending_earnings || 0) + ' Stars';
                document.getElementById('referral-url').textContent = data.referral_link || 'Not available';
                referralLink = data.referral_link;
            });
        }
        
        function copyReferralLink() {
            if (!referralLink) return;
            
            navigator.clipboard.writeText(referralLink).then(() => {
                Telegram.WebApp.showPopup({
                    title: 'Copied!',
                    message: 'Referral link copied to clipboard',
                    buttons: [{ type: 'default', text: 'OK' }]
                });
            });
        }
        
        function shareReferralLink() {
            if (!referralLink) return;
            
            Telegram.WebApp.shareUrl(referralLink, 'Join CryptoGamer using my referral link!');
        }
        
        document.addEventListener('DOMContentLoaded', loadAffiliateStats);
    </script>
</body>
</html>