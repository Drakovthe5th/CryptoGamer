<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Crew: Sabotage</title>
    <style>
        :root {
            --primary-bg: #0a0a1a;
            --secondary-bg: #15152b;
            --accent: #ffcc00;
            --accent-glow: 0 0 10px rgba(255, 204, 0, 0.7);
            --text-primary: #ffffff;
            --text-secondary: #cccccc;
            --danger: #ff4757;
            --success: #2ed573;
            --miner-color: #3498db;
            --saboteur-color: #e74c3c;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--primary-bg);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(255, 204, 0, 0.3);
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent);
            text-shadow: var(--accent-glow);
        }
        
        .game-info {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        
        .info-box {
            background-color: var(--secondary-bg);
            padding: 10px 15px;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 100px;
        }
        
        .info-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 18px;
            font-weight: bold;
            color: var(--accent);
        }
        
        .game-content {
            display: grid;
            grid-template-columns: 3fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .ship-map {
            background-color: var(--secondary-bg);
            border-radius: 10px;
            padding: 20px;
            position: relative;
            min-height: 500px;
            background-image: radial-gradient(circle at center, #1a1a3a 0%, #0a0a1a 100%);
        }
        
        .map-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 15px;
            height: 100%;
        }
        
        .room {
            background-color: rgba(30, 30, 60, 0.7);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }
        
        .room:hover {
            border-color: var(--accent);
            box-shadow: var(--accent-glow);
        }
        
        .room.active {
            border-color: var(--accent);
            box-shadow: var(--accent-glow);
        }
        
        .room-icon {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .room-name {
            font-size: 14px;
            text-align: center;
        }
        
        .player-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            position: absolute;
            bottom: 5px;
            right: 5px;
        }
        
        .miner-dot {
            background-color: var(--miner-color);
            box-shadow: 0 0 5px var(--miner-color);
        }
        
        .saboteur-dot {
            background-color: var(--saboteur-color);
            box-shadow: 0 0 5px var(--saboteur-color);
        }
        
        .game-sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .player-list {
            background-color: var(--secondary-bg);
            border-radius: 10px;
            padding: 15px;
        }
        
        .section-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .player-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 8px;
            background-color: rgba(40, 40, 70, 0.5);
        }
        
        .player-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: #2c2c54;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: bold;
        }
        
        .player-info {
            flex: 1;
        }
        
        .player-name {
            font-size: 14px;
            margin-bottom: 3px;
        }
        
        .player-role {
            font-size: 12px;
            opacity: 0.7;
        }
        
        .player-status {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-left: 10px;
        }
        
        .status-online {
            background-color: var(--success);
            box-shadow: 0 0 5px var(--success);
        }
        
        .status-offline {
            background-color: var(--text-secondary);
        }
        
        .action-panel {
            background-color: var(--secondary-bg);
            border-radius: 10px;
            padding: 15px;
        }
        
        .action-btn {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background-color: var(--accent);
            color: #000;
            font-weight: bold;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 204, 0, 0.4);
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn-emergency {
            background-color: var(--danger);
            color: white;
        }
        
        .task-list {
            background-color: var(--secondary-bg);
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .task-item {
            padding: 10px;
            border-left: 3px solid var(--accent);
            margin-bottom: 10px;
            background-color: rgba(40, 40, 70, 0.5);
            border-radius: 0 5px 5px 0;
        }
        
        .task-title {
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .task-progress {
            height: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
        }
        
        .task-progress-bar {
            height: 100%;
            background-color: var(--accent);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background-color: var(--secondary-bg);
            border-radius: 10px;
            padding: 20px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 20px;
            color: var(--accent);
        }
        
        .close-modal {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 24px;
            cursor: pointer;
        }
        
        .voting-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .vote-option {
            padding: 15px;
            background-color: rgba(40, 40, 70, 0.5);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .vote-option:hover {
            background-color: rgba(40, 40, 70, 0.8);
            transform: translateY(-2px);
        }
        
        .mini-game {
            text-align: center;
        }
        
        .game-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        
        .game-cell {
            aspect-ratio: 1;
            background-color: rgba(40, 40, 70, 0.5);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .game-cell:hover {
            background-color: rgba(40, 40, 70, 0.8);
        }
        
        .game-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }
        
        .btn-primary {
            padding: 10px 20px;
            background-color: var(--accent);
            color: #000;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .btn-secondary {
            padding: 10px 20px;
            background-color: transparent;
            color: var(--text-primary);
            border: 1px solid var(--text-secondary);
            border-radius: 5px;
            cursor: pointer;
        }
        
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px;
            background-color: var(--secondary-bg);
            border-left: 4px solid var(--accent);
            border-radius: 5px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 350px;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .notification-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--accent);
        }
        
        .role-reveal {
            text-align: center;
            padding: 30px;
        }
        
        .role-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
        
        .role-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--accent);
        }
        
        .role-description {
            margin-bottom: 20px;
            line-height: 1.5;
        }
        
        /* Credit Purchase Styles */
        .credit-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .credit-option {
            background-color: rgba(40, 40, 70, 0.5);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .credit-option:hover {
            border-color: var(--accent);
            box-shadow: var(--accent-glow);
        }
        
        .stars-amount {
            font-size: 18px;
            font-weight: bold;
            color: var(--accent);
            margin-bottom: 5px;
        }
        
        .credits-amount {
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        @media (max-width: 768px) {
            .game-content {
                grid-template-columns: 1fr;
            }
            
            .map-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .voting-options {
                grid-template-columns: 1fr;
            }
            
            .credit-options {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .game-info {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">Crypto Crew: Sabotage</div>
            <div class="game-info">
                <div class="info-box">
                    <div class="info-label">TIME LEFT</div>
                    <div class="info-value" id="time-left">15:00</div>
                </div>
                <div class="info-box">
                    <div class="info-label">VAULT GOLD</div>
                    <div class="info-value" id="vault-gold">0</div>
                </div>
                <div class="info-box">
                    <div class="info-label">PLAYERS</div>
                    <div class="info-value" id="players-count">6/6</div>
                </div>
                <div class="info-box">
                    <div class="info-label">CREW CREDITS</div>
                    <div class="info-value" id="crew-credits">0</div>
                </div>
                <button class="action-btn" id="btn-buy-credits">Buy Crew Credits</button>
            </div>
        </header>
        
        <div class="game-content">
            <div class="ship-map">
                <div class="map-grid">
                    <div class="room" data-room="navigation">
                        <div class="room-icon">üß≠</div>
                        <div class="room-name">Navigation</div>
                        <div class="player-dot miner-dot" style="display: none;"></div>
                    </div>
                    <div class="room" data-room="electrical">
                        <div class="room-icon">‚ö°</div>
                        <div class="room-name">Electrical</div>
                        <div class="player-dot miner-dot" style="display: none;"></div>
                    </div>
                    <div class="room" data-room="oxygen">
                        <div class="room-icon">üí®</div>
                        <div class="room-name">Oxygen</div>
                        <div class="player-dot miner-dot" style="display: none;"></div>
                    </div>
                    <div class="room" data-room="weapons">
                        <div class="room-icon">üî´</div>
                        <div class="room-name">Weapons</div>
                        <div class="player-dot miner-dot" style="display: none;"></div>
                    </div>
                    <div class="room" data-room="cafeteria">
                        <div class="room-icon">üçî</div>
                        <div class="room-name">Cafeteria</div>
                        <div class="player-dot miner-dot" style="display: none;"></div>
                    </div>
                    <div class="room" data-room="medbay">
                        <div class="room-icon">üíä</div>
                        <div class="room-name">Medbay</div>
                        <div class="player-dot miner-dot" style="display: none;"></div>
                    </div>
                    <div class="room" data-room="storage">
                        <div class="room-icon">üì¶</div>
                        <div class="room-name">Storage</div>
                        <div class="player-dot miner-dot" style="display: none;"></div>
                    </div>
                    <div class="room" data-room="admin">
                        <div class="room-icon">üìä</div>
                        <div class="room-name">Admin</div>
                        <div class="player-dot miner-dot" style="display: none;"></div>
                    </div>
                    <div class="room" data-room="communications">
                        <div class="room-icon">üì°</div>
                        <div class="room-name">Communications</div>
                        <div class="player-dot miner-dot" style="display: none;"></div>
                    </div>
                </div>
            </div>
            
            <div class="game-sidebar">
                <div class="player-list">
                    <h2 class="section-title">üë• Crew Members</h2>
                    <div id="players-container">
                        <!-- Players will be added dynamically -->
                    </div>
                </div>
                
                <div class="action-panel">
                    <h2 class="section-title">‚ö° Actions</h2>
                    <button class="action-btn" id="btn-mine">Mine Gold</button>
                    <button class="action-btn" id="btn-steal" style="display: none;">Steal Gold</button>
                    <button class="action-btn btn-emergency" id="btn-meeting">Call Emergency Meeting</button>
                    <button class="action-btn" id="btn-bribe" style="display: none;">Bribe Player</button>
                </div>
            </div>
        </div>
        
        <div class="task-list">
            <h2 class="section-title">üìù Tasks</h2>
            <div id="tasks-container">
                <!-- Tasks will be added dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Modals -->
    <div class="modal" id="meeting-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Emergency Meeting</h2>
                <button class="close-modal">&times;</button>
            </div>
            <p>Discuss with your crew and vote who you think is the saboteur.</p>
            <div class="voting-options" id="voting-options">
                <!-- Voting options will be added dynamically -->
            </div>
        </div>
    </div>
    
    <div class="modal" id="task-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="task-modal-title">Task Name</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="mini-game" id="mini-game-container">
                <!-- Mini-game will be loaded here -->
            </div>
        </div>
    </div>
    
    <div class="modal" id="bribe-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Bribe Player</h2>
                <button class="close-modal">&times;</button>
            </div>
            <p>Select a player to bribe with 500 gold from the saboteurs' stash:</p>
            <div class="voting-options" id="bribe-options">
                <!-- Bribe options will be added dynamically -->
            </div>
        </div>
    </div>
    
    <div class="modal" id="role-modal">
        <div class="modal-content">
            <div class="role-reveal">
                <div class="role-icon" id="role-icon">üë®‚ÄçüöÄ</div>
                <h2 class="role-title" id="role-title">Miner</h2>
                <p class="role-description" id="role-description">
                    Your goal is to complete tasks to mine gold and identify both Saboteurs before time runs out or before over 50% of the gold is stolen.
                </p>
                <button class="btn-primary" id="btn-start-game">Start Game</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="game-over-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="game-over-title">Game Over</h2>
            </div>
            <div id="game-over-content">
                <!-- Game over content will be added dynamically -->
            </div>
        </div>
    </div>
    
    <div class="modal" id="credits-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Buy Crew Credits</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <p>Crew Credits are used exclusively for Crypto Crew: Sabotage.</p>
                <div class="credit-options">
                    <div class="credit-option" data-stars="100">
                        <div class="stars-amount">100 Stars</div>
                        <div class="credits-amount">10,000 Credits</div>
                        <button class="btn-primary">Purchase</button>
                    </div>
                    <div class="credit-option" data-stars="500">
                        <div class="stars-amount">500 Stars</div>
                        <div class="credits-amount">50,000 Credits</div>
                        <button class="btn-primary">Purchase</button>
                    </div>
                    <div class="credit-option" data-stars="1000">
                        <div class="stars-amount">1000 Stars</div>
                        <div class="credits-amount">100,000 Credits</div>
                        <button class="btn-primary">Purchase</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <div class="notification-title" id="notification-title">Notification</div>
        <div class="notification-message" id="notification-message">This is a notification message.</div>
    </div>

    <script>
        // Game state
        const gameState = {
            timeLeft: 15 * 60, // 15 minutes in seconds
            vaultGold: 0,
            saboteursStash: 0,
            crewCredits: 0,
            players: [],
            currentPlayer: {
                id: null,
                name: "Player",
                role: null,
                isAlive: true,
                room: "cafeteria"
            },
            tasks: [
                { id: 1, name: "Align Navigation Systems", room: "navigation", progress: 0, completed: false },
                { id: 2, name: "Fix Electrical Wiring", room: "electrical", progress: 0, completed: false },
                { id: 3, name: "Calibrate Oxygen Levels", room: "oxygen", progress: 0, completed: false },
                { id: 4, name: "Charge Weapon Systems", room: "weapons", progress: 0, completed: false },
                { id: 5, name: "Restock Food Supplies", room: "cafeteria", progress: 0, completed: false },
                { id: 6, name: "Organize Medical Supplies", room: "medbay", progress: 0, completed: false },
                { id: 7, name: "Sort Storage Containers", room: "storage", progress: 0, completed: false },
                { id: 8, name: "Update Admin Records", room: "admin", progress: 0, completed: false },
                { id: 9, name: "Establish Communications", room: "communications", progress: 0, completed: false }
            ],
            gameActive: false,
            isMeeting: false
        };

        // DOM Elements
        const timeLeftEl = document.getElementById('time-left');
        const vaultGoldEl = document.getElementById('vault-gold');
        const crewCreditsEl = document.getElementById('crew-credits');
        const playersCountEl = document.getElementById('players-count');
        const playersContainerEl = document.getElementById('players-container');
        const tasksContainerEl = document.getElementById('tasks-container');
        const btnMine = document.getElementById('btn-mine');
        const btnSteal = document.getElementById('btn-steal');
        const btnMeeting = document.getElementById('btn-meeting');
        const btnBribe = document.getElementById('btn-bribe');
        const btnBuyCredits = document.getElementById('btn-buy-credits');
        const meetingModal = document.getElementById('meeting-modal');
        const taskModal = document.getElementById('task-modal');
        const bribeModal = document.getElementById('bribe-modal');
        const creditsModal = document.getElementById('credits-modal');
        const roleModal = document.getElementById('role-modal');
        const gameOverModal = document.getElementById('game-over-modal');
        const notificationEl = document.getElementById('notification');

        // Initialize game
        function initGame() {
            // In a real implementation, this would come from the backend
            gameState.players = [
                { id: 1, name: "You", role: "miner", isAlive: true, room: "cafeteria" },
                { id: 2, name: "SpaceExplorer", role: "miner", isAlive: true, room: "navigation" },
                { id: 3, name: "MoonWalker", role: "miner", isAlive: true, room: "electrical" },
                { id: 4, name: "StarGazer", role: "miner", isAlive: true, room: "oxygen" },
                { id: 5, name: "CosmoKid", role: "saboteur", isAlive: true, room: "weapons" },
                { id: 6, name: "OrbitQueen", role: "saboteur", isAlive: true, room: "medbay" }
            ];
            
            // Randomly assign role to current player (for demo purposes)
            const randomRole = Math.random() > 0.7 ? "saboteur" : "miner";
            gameState.currentPlayer.role = randomRole;
            gameState.players[0].role = randomRole;
            
            updatePlayersDisplay();
            updateTasksDisplay();
            loadCreditsBalance();
            showRoleModal();
            
            // Start game timer
            startGameTimer();
        }
        
        // Load credits balance
        async function loadCreditsBalance() {
            try {
                // In a real implementation, this would fetch from the backend
                // For demo purposes, we'll use a mock value
                const mockCredits = 1500;
                gameState.crewCredits = mockCredits;
                crewCreditsEl.textContent = mockCredits.toLocaleString();
                
                // Enable/disable join button based on credits
                const joinButton = document.getElementById('btn-join-game');
                if (joinButton) {
                    joinButton.disabled = mockCredits < 100;
                }
            } catch (error) {
                console.error('Error loading credits balance:', error);
                showNotification('Error', 'Failed to load credits balance');
            }
        }
        
        // Show role modal at game start
        function showRoleModal() {
            const roleIcon = document.getElementById('role-icon');
            const roleTitle = document.getElementById('role-title');
            const roleDescription = document.getElementById('role-description');
            
            if (gameState.currentPlayer.role === 'saboteur') {
                roleIcon.textContent = 'üïµÔ∏è';
                roleTitle.textContent = 'Saboteur';
                roleDescription.textContent = 'Your goal is to secretly steal gold from the common vault and avoid detection. You win if you collectively steal >50% of the total gold mined or if time runs out and you are not both ejected.';
                
                // Show saboteur actions
                btnSteal.style.display = 'block';
                btnBribe.style.display = 'block';
            } else {
                roleIcon.textContent = 'üë®‚ÄçüöÄ';
                roleTitle.textContent = 'Miner';
                roleDescription.textContent = 'Your goal is to complete tasks to mine gold and identify both Saboteurs before time runs out or before over 50% of the gold is stolen.';
            }
            
            roleModal.style.display = 'flex';
        }
        
        // Start game timer
        function startGameTimer() {
            const timer = setInterval(() => {
                if (gameState.gameActive && !gameState.isMeeting) {
                    gameState.timeLeft--;
                    
                    const minutes = Math.floor(gameState.timeLeft / 60);
                    const seconds = gameState.timeLeft % 60;
                    timeLeftEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    
                    // Check for win conditions
                    if (gameState.timeLeft <= 0) {
                        clearInterval(timer);
                        endGame('time');
                    } else if (gameState.saboteursStash > gameState.vaultGold / 2) {
                        clearInterval(timer);
                        endGame('saboteurs');
                    }
                }
            }, 1000);
        }
        
        // Update players display
        function updatePlayersDisplay() {
            playersContainerEl.innerHTML = '';
            playersCountEl.textContent = `${gameState.players.filter(p => p.isAlive).length}/6`;
            
            gameState.players.forEach(player => {
                const playerEl = document.createElement('div');
                playerEl.className = 'player-item';
                
                playerEl.innerHTML = `
                    <div class="player-avatar">${player.name.charAt(0)}</div>
                    <div class="player-info">
                        <div class="player-name">${player.name} ${player.id === 1 ? '(You)' : ''}</div>
                        <div class="player-role">${player.isAlive ? (player.role === 'saboteur' ? 'Crewmate' : 'Crewmate') : 'Ejected'}</div>
                    </div>
                    <div class="player-status ${player.isAlive ? 'status-online' : 'status-offline'}"></div>
                `;
                
                playersContainerEl.appendChild(playerEl);
            });
            
            // Update player dots on map
            updatePlayerPositions();
        }
        
        // Update player positions on map
        function updatePlayerPositions() {
            // Clear all player dots
            document.querySelectorAll('.player-dot').forEach(dot => {
                dot.style.display = 'none';
            });
            
            // Show player dots for each room
            gameState.players.forEach(player => {
                if (player.isAlive) {
                    const roomEl = document.querySelector(`.room[data-room="${player.room}"]`);
                    if (roomEl) {
                        const dot = roomEl.querySelector('.player-dot');
                        dot.style.display = 'block';
                        dot.className = `player-dot ${player.role === 'saboteur' ? 'saboteur-dot' : 'miner-dot'}`;
                    }
                }
            });
        }
        
        // Update tasks display
        function updateTasksDisplay() {
            tasksContainerEl.innerHTML = '';
            
            gameState.tasks.forEach(task => {
                if (!task.completed) {
                    const taskEl = document.createElement('div');
                    taskEl.className = 'task-item';
                    taskEl.innerHTML = `
                        <div class="task-title">${task.name} (${task.room})</div>
                        <div class="task-progress">
                            <div class="task-progress-bar" style="width: ${task.progress}%"></div>
                        </div>
                    `;
                    tasksContainerEl.appendChild(taskEl);
                }
            });
        }
        
        // Show notification
        function showNotification(title, message) {
            document.getElementById('notification-title').textContent = title;
            document.getElementById('notification-message').textContent = message;
            
            notificationEl.classList.add('show');
            
            setTimeout(() => {
                notificationEl.classList.remove('show');
            }, 3000);
        }
        
        // End game
        function endGame(reason) {
            gameState.gameActive = false;
            
            const gameOverTitle = document.getElementById('game-over-title');
            const gameOverContent = document.getElementById('game-over-content');
            
            if (reason === 'saboteurs') {
                gameOverTitle.textContent = 'Saboteurs Win!';
                gameOverContent.innerHTML = `
                    <p>The saboteurs have successfully stolen more than half of the gold!</p>
                    <p>Total Gold Mined: ${gameState.vaultGold + gameState.saboteursStash}</p>
                    <p>Gold Stolen: ${gameState.saboteursStash}</p>
                    <h3>Rewards:</h3>
                    <p>Saboteurs receive 4,000 GC each</p>
                `;
            } else if (reason === 'miners') {
                gameOverTitle.textContent = 'Miners Win!';
                gameOverContent.innerHTML = `
                    <p>The miners have successfully identified and ejected all saboteurs!</p>
                    <p>Total Gold Mined: ${gameState.vaultGold + gameState.saboteursStash}</p>
                    <p>Gold Protected: ${gameState.vaultGold}</p>
                    <h3>Rewards:</h3>
                    <p>Miners receive 2,000 GC each</p>
                `;
            } else {
                gameOverTitle.textContent = 'Time\'s Up!';
                if (gameState.saboteursStash > gameState.vaultGold / 2) {
                    gameOverContent.innerHTML = `
                        <p>The saboteurs have successfully stolen more than half of the gold!</p>
                        <p>Total Gold Mined: ${gameState.vaultGold + gameState.saboteursStash}</p>
                        <p>Gold Stolen: ${gameState.saboteursStash}</p>
                        <h3>Rewards:</h3>
                        <p>Saboteurs receive 4,000 GC each</p>
                    `;
                } else {
                    gameOverContent.innerHTML = `
                        <p>The game ended in a stalemate!</p>
                        <p>Total Gold Mined: ${gameState.vaultGold + gameState.saboteursStash}</p>
                        <p>Gold Stolen: ${gameState.saboteursStash}</p>
                        <h3>Rewards:</h3>
                        <p>All players receive 1,333 GC each</p>
                    `;
                }
            }
            
            gameOverModal.style.display = 'flex';
        }
        
        // Handle credit purchase
        async function handleCreditPurchase(starsAmount) {
            try {
                // In a real implementation, this would call the backend API
                // For demo purposes, we'll simulate the purchase
                const creditsAmount = starsAmount * 100; // 1 star = 100 credits
                
                // Simulate API delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Update credits balance
                gameState.crewCredits += creditsAmount;
                crewCreditsEl.textContent = gameState.crewCredits.toLocaleString();
                
                // Close modal
                creditsModal.style.display = 'none';
                
                // Show success message
                showNotification('Purchase Successful', `You bought ${creditsAmount.toLocaleString()} Crew Credits!`);
            } catch (error) {
                console.error('Error purchasing credits:', error);
                showNotification('Purchase Failed', 'An error occurred during purchase');
            }
        }
        
        // Event Listeners
        document.getElementById('btn-start-game').addEventListener('click', () => {
            roleModal.style.display = 'none';
            gameState.gameActive = true;
        });
        
        btnMine.addEventListener('click', () => {
            // Find a task in the current room
            const availableTasks = gameState.tasks.filter(task => 
                task.room === gameState.currentPlayer.room && !task.completed
            );
            
            if (availableTasks.length > 0) {
                const task = availableTasks[0];
                openTaskModal(task);
            } else {
                showNotification('No Tasks', 'There are no available tasks in this room.');
            }
        });
        
        btnSteal.addEventListener('click', () => {
            if (gameState.vaultGold >= 267) {
                gameState.vaultGold -= 267;
                gameState.saboteursStash += 267;
                vaultGoldEl.textContent = gameState.vaultGold;
                showNotification('Gold Stolen', 'You successfully stole 267 gold from the vault!');
            } else {
                showNotification('Steal Failed', 'Not enough gold in the vault to steal.');
            }
        });
        
        btnMeeting.addEventListener('click', () => {
            openMeetingModal();
        });
        
        btnBribe.addEventListener('click', () => {
            if (gameState.saboteursStash >= 500) {
                openBribeModal();
            } else {
                showNotification('Bribe Failed', 'Not enough gold in the saboteurs stash for a bribe (500 required).');
            }
        });
        
        btnBuyCredits.addEventListener('click', () => {
            creditsModal.style.display = 'flex';
        });
        
        // Room click handling
        document.querySelectorAll('.room').forEach(room => {
            room.addEventListener('click', () => {
                gameState.currentPlayer.room = room.dataset.room;
                updatePlayerPositions();
                showNotification('Room Changed', `You moved to ${room.dataset.room}`);
            });
        });
        
        // Modal close buttons
        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.closest('.modal').style.display = 'none';
            });
        });
        
        // Credit purchase options
        document.querySelectorAll('.credit-option').forEach(option => {
            option.querySelector('button').addEventListener('click', () => {
                const starsAmount = parseInt(option.dataset.stars);
                handleCreditPurchase(starsAmount);
            });
        });
        
        // Initialize the game when page loads
        window.addEventListener('load', initGame);
        
        // These functions would be implemented based on the specific mini-games
        function openTaskModal(task) {
            document.getElementById('task-modal-title').textContent = task.name;
            const gameContainer = document.getElementById('mini-game-container');
            
            // Simple mini-game implementation (would be more complex in real game)
            gameContainer.innerHTML = `
                <p>Click the buttons in the correct sequence to complete the task.</p>
                <div class="game-grid">
                    <div class="game-cell">1</div>
                    <div class="game-cell">2</div>
                    <div class="game-cell">3</div>
                    <div class="game-cell">4</div>
                    <div class="game-cell">5</div>
                    <div class="game-cell">6</div>
                    <div class="game-cell">7</div>
                    <div class="game-cell">8</div>
                    <div class="game-cell">9</div>
                </div>
                <div class="game-controls">
                    <button class="btn-primary" id="btn-complete-task">Complete Task</button>
                    <button class="btn-secondary" id="btn-cancel-task">Cancel</button>
                </div>
            `;
            
            document.getElementById('btn-complete-task').addEventListener('click', () => {
                task.completed = true;
                gameState.vaultGold += 134;
                vaultGoldEl.textContent = gameState.vaultGold;
                updateTasksDisplay();
                taskModal.style.display = 'none';
                showNotification('Task Complete', 'You mined 134 gold for the vault!');
            });
            
            document.getElementById('btn-cancel-task').addEventListener('click', () => {
                taskModal.style.display = 'none';
            });
            
            taskModal.style.display = 'flex';
        }
        
        function openMeetingModal() {
            const votingOptions = document.getElementById('voting-options');
            votingOptions.innerHTML = '';
            
            gameState.players.forEach(player => {
                if (player.id !== 1 && player.isAlive) {
                    const option = document.createElement('div');
                    option.className = 'vote-option';
                    option.textContent = player.name;
                    option.addEventListener('click', () => {
                        showNotification('Vote Cast', `You voted to eject ${player.name}`);
                        meetingModal.style.display = 'none';
                        
                        // 30% chance of ejecting a saboteur for demo purposes
                        if (player.role === 'saboteur' && Math.random() < 0.3) {
                            player.isAlive = false;
                            showNotification('Ejection Result', `${player.name} was ejected. They were a saboteur!`);
                            
                            // Check if all saboteurs are ejected
                            const saboteursAlive = gameState.players.filter(p => 
                                p.role === 'saboteur' && p.isAlive
                            );
                            
                            if (saboteursAlive.length === 0) {
                                endGame('miners');
                            }
                        } else {
                            showNotification('Ejection Result', `${player.name} was ejected. They were a miner!`);
                            player.isAlive = false;
                        }
                        
                        updatePlayersDisplay();
                    });
                    
                    votingOptions.appendChild(option);
                }
            });
            
            meetingModal.style.display = 'flex';
            gameState.isMeeting = true;
            
            // Close meeting after 2 minutes (for demo, we'll use 10 seconds)
            setTimeout(() => {
                if (meetingModal.style.display === 'flex') {
                    meetingModal.style.display = 'none';
                    gameState.isMeeting = false;
                    showNotification('Meeting Ended', 'The meeting ended with no ejections.');
                }
            }, 10000);
        }
        
        function openBribeModal() {
            const bribeOptions = document.getElementById('bribe-options');
            bribeOptions.innerHTML = '';
            
            gameState.players.forEach(player => {
                if (player.role === 'miner' && player.isAlive) {
                    const option = document.createElement('div');
                    option.className = 'vote-option';
                    option.textContent = player.name;
                    option.addEventListener('click', () => {
                        // 50% chance of successful bribe for demo purposes
                        if (Math.random() < 0.5) {
                            player.role = 'traitor';
                            gameState.saboteursStash -= 500;
                            showNotification('Bribe Successful', `${player.name} has accepted your bribe and is now a traitor!`);
                        } else {
                            showNotification('Bribe Rejected', `${player.name} rejected your bribe offer.`);
                        }
                        
                        bribeModal.style.display = 'none';
                        updatePlayersDisplay();
                    });
                    
                    bribeOptions.appendChild(option);
                }
            });
            
            bribeModal.style.display = 'flex';
        }
    </script>
</body>
</html>